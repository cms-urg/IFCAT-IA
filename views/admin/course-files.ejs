<%- include ./header -%>

<h1><%= course.code + ' - ' + course.name %><br><small>Files</small></h1>

<%- include ./flash %>

<div class="nav-actions" style="width: 500px">
    <button class="btn btn-default btn-sm" data-toggle="modal" data-target="#modal-upload-files"><span 
        class="glyphicon glyphicon-plus"></span> Upload Files</button>
    <button class="btn btn-danger btn-sm pull-right<%= course.files.length ? '' : ' disabled' %>" id="btn-delete"><span 
        class="glyphicon glyphicon-remove"></span> Delete Files</a>
</div>

<table class="table table-striped" style="width: 500px; min-width: 500px">
    <thead>
        <tr>
            <th style="width: 10px;"><input type="checkbox" value="1"></th>
            <th>Name</th>
            <th>Type</th>
        </tr>
    </thead>
    <tbody>
    <% if (_.isEmpty(course.files)) { %> 
        <tr><td colspan="3">No files have been added yet.</td></tr>
    <% } else { %>  
        <% _.each(course.files, function (file) { %>
            <tr>
                <td><input type="checkbox" name="files[]" value="<%= file.id %>"></td>
                <td>
                    <a href="/upl/<%= course.id %>/<%= file.name %>" target="_preview"><%= file.name %></a>
                <% if (file.isImage()) { %>
                    <img src="/upl/<%= course.id %>/<%= file.name %>" class="preview" style="display: none">
                <% } else if (file.isAudio()) { %>
                    <audio controls class="preview" style="display: none">
                        <source src="/upl/<%= course.id %>/<%= file.name %>" type="<%= file.type %>">
                    </audio>
                <% } %>
                </td>
                <td><%= file.type %></td>
            </tr>
        <% }) %>
    <% } %>
    </tbody>
</table>

<%- include ./body-js -%>
<script>
$(function () {
    $('#btn-delete').click(function () {
        var $checkboxes = $('tbody :checkbox:checked');
        if ($checkboxes.length) {
            $.deletebox({
                title: 'Delete files',
                message: '<p>You are about to delete files <b>(' + $checkboxes.length + ')</b> and all of their associations.</p>\
                    <p>This action <b>cannot be undone</b>. Do you want to proceed with this action?</p>',
                callback: function () {
                    $.delete(window.location.href, $checkboxes.serialize(), function () { window.location.reload(true); });
                }
            })
        }
    });
    // preview image and audio files
    $('tbody > tr:has(.preview) a').click(function (e) {
        e.preventDefault();
        bootbox.dialog({
            onEscape: true,
            className: 'modal-preview-file',
            message: $(this).next('.preview').clone().css('display', '')
        });
    });
});
</script>
<%- include ./modals/upload-files -%>
<%- include ./footer -%>