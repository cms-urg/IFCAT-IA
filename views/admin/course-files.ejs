<%- include ./header -%>

<h1><%= course.code + ' - ' + course.name %><br><small>Files</small></h1>

<%- include ./flash %>

<div class="nav-actions">
    <button class="btn btn-default btn-sm" data-toggle="modal" data-target="#modal-upload-files"><span 
        class="glyphicon glyphicon-plus"></span> Upload Files</button>
    <a href="/admin/courses/<%= course.id %>/files" class="btn btn-danger btn-sm pull-right 
        btn-delete<%= course.files.length ? '' : ' disabled' %>" id="btn-delete-files"><span class="glyphicon 
        glyphicon-remove"></span> Delete Files</a>
</div>

<table class="table table-striped" id="table-files">
    <thead>
        <tr>
            <th style="width: 10px;"><input type="checkbox" value="1"></th>
            <th>Name</th>
            <th>Type</th>
            <th>Created on</th>
        </tr>
    </thead>
    <tbody>
    <% if (_.isEmpty(course.files)) { %> 
        <tr><td colspan="4">No files have been added yet.</td></tr>
    <% } else { %>  
        <% _.each(course.files, function (file) { %>
            <tr>
                <td><input type="checkbox" name="files[]" value="<%= file.id %>"></td>
                <td>
                    <a href="/upl/<%= course.id %>/<%= file.name %>" target="_preview"><%= file.name %></a>
                <% if (file.isImage()) { %>
                    <img src="/upl/<%= course.id %>/<%= file.name %>" class="preview" style="display: none">
                <% } else if (file.isAudio()) { %>
                    <audio controls class="preview" style="display: none">
                        <source src="/upl/<%= course.id %>/<%= file.name %>" type="<%= file.type %>">
                    </audio>
                <% } %>
                </td>
                <td><%= file.type %></td>
                <td><%= moment(file.createdAt).format(dateFormat) %></td>
            </tr>
        <% }) %>
    <% } %>
    </tbody>
</table>

<script type="text/template" id="btn-delete-message-template">
    <p>You are about to delete files and all of their associations.</p>
    <p>This action <b>cannot be undone</b>. Do you want to proceed with this action?</p>  
</script>

<%- include ./body-js -%>
<%- include ./modals/upload-files -%>

<script>
$(function () {
    // preview image and audio files
    $('#table-files tbody tr:has(.preview) a').on('click', function (e) {
        e.preventDefault();
        bootbox.dialog({
            onEscape: true,
            className: 'modal-preview-file',
            message: $(this).next('.preview').clone().css('display', '')
        });
    });
});
</script>

<%- include ./footer -%>