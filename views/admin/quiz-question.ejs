<%- include ./header -%>

<h1><%= course.code + ' - ' + course.name %><br>
<small>Quiz <%= quiz.number %> - <%= question.isNew ? 'Add new question' : 'Edit question' %></small></h1>

<form id="form-question" action="/admin/courses/<%= course.id %>/quizzes/<%= quiz.id %>/questions/<%= 
    question.isNew ? '' : question.id + '?_method=put' %>" method="post" class="form-horizontal">
    
    <div class="form-group">
        <label for="question" class="col-sm-2 control-label">Number</label>
        <div class="col-sm-2">
            <input name="number" value="<%= question.number %>" maxlength="6" class="form-control" placeholder="e.g. 1, A or 1a">
        </div>
    </div>

    <div class="form-group">
        <label for="question" class="col-sm-2 control-label">Question</label>
        <div class="col-sm-10">
            <textarea name="question" class="form-control" rows="3"><%= question.question %></textarea>
        </div>
    </div>

    <div class="form-group">
        <label for="type" class="col-sm-2 control-label">Type</label>
        <div class="col-sm-10">
            <select name="type" class="form-control">
            <% _.each(question.schema.path('type').enumValues, function (type) { %>
                <option value="<%= type %>"<%= question.type === type ? 
                    ' selected' : '' %>><%= _.upperFirst(type) %></option>            
            <% }) %>
            </select>
        </div>
    </div>

    <!-- files -->

    <div class="form-group">
        <label for="type" class="col-sm-2 control-label">Files</label>
        <div class="col-sm-10">
            <a href="#" class="btn btn-default btn-sm<%= course.files.length ? 
                '' : ' disabled' %>" data-toggle="modal" data-target="#modal-show-files">
                <span class="glyphicon glyphicon-file"></span> Show files</a>
            <%- include ./modals/show-files %>
        </div>
    </div>

    <!-- links -->

    <div class="form-group">
        <label for="type" class="col-sm-2 control-label">Links</label>
        <div class="col-sm-10">
            <a href="#" class="btn btn-default btn-sm" data-toggle="modal" data-target="#modal-show-links">
                <span class="glyphicon glyphicon-link"></span> Show links</a>
            <%- include ./modals/show-links %>
        </div>
    </div>

    <!-- choices -->

    <div class="form-group">
        <label for="question" class="col-sm-2 control-label">Choices/Answer</label>

        <!-- for multiple choice -->

        <% if (question.isNew || !question.isMultipleChoice()) { %>
            <div class="col-sm-10 multiple-choice" style="display: none;">
            <% for (var i = 0, len = 3; i < 3; i++) { %>    
                <div class="form-group">
                    <div class="col-xs-8"> 
                        <textarea name="choices[<%= i %>]" class="form-control" rows="1" disabled></textarea>
                    </div>
                    <div class="col-xs-4 radio">
                        <label><input type="radio" name="answer[multiple-choice]" value="<%= i %>" disabled<%= 
                            !i ? ' checked' : '' %>></label>
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <div class="col-sm-10 multiple-choice">
            <% _.each(question.choices, function (choice, i) { %>    
                <div class="form-group">
                    <div class="col-xs-8"> 
                        <textarea name="choices[<%= i %>]" class="form-control" rows="1"><%= choice %></textarea>
                    </div>
                    <div class="col-xs-4 radio">
                        <label><input type="radio" name="answer[multiple-choice]" 
                            value="<%= i %>"<%= question.isAnswer(choice) ? ' checked' : '' %>></label>
                    </div>
                </div>
            <% }) %>
        <% } %>
                <div class="form-group">
                    <div class="col-sm-10">
                        <button type="button" class="btn btn-default btn-sm btn-add-choice">
                            <span class="glyphicon glyphicon-plus"></span> Add another choice
                        </button>
                    </div>
                </div>
            </div>

        <!-- for multiple select -->

        <% if (question.isNew || !question.isMultipleSelect()) { %>
            <div class="col-sm-10 multiple-select" style="display: none;">
            <% for (var i = 0, len = 3; i < 3; i++) { %>    
                <div class="form-group">
                    <div class="col-xs-8"> 
                        <textarea name="choices[<%= i %>]" class="form-control" rows="1" disabled></textarea>
                    </div>
                    <div class="col-xs-4 checkbox">
                        <label><input type="checkbox" name="answers[multiple-select][]" value="<%= i %>" disabled></label>
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <div class="col-sm-10 multiple-select">
            <% _.each(question.choices, function (choice, i) { %>    
                <div class="form-group">
                    <div class="col-xs-8"> 
                        <textarea name="choices[<%= i %>]" class="form-control" rows="1"><%= choice %></textarea>
                    </div>
                    <div class="col-xs-4 checkbox">
                        <label><input type="checkbox" name="answers[multiple-select][]" value="<%= i %>"<%= 
                            question.isAnswer(choice) ? ' checked' : '' %>></label>
                    </div>
                </div>
            <% }) %> 
        <% } %>
                <div class="form-group">
                    <div class="col-sm-10">
                        <button type="button" class="btn btn-default btn-sm btn-add-choice">
                            <span class="glyphicon glyphicon-plus"></span> Add another choice
                        </button>
                    </div>
                </div>
            </div>

        <!-- for short answer -->

        <% if (question.isNew || !question.isShortAnswer()) { %>
            <div class="col-sm-10 short-answer" style="display: none;">
            <% for (var i = 0, len = 3; i < 3; i++) { %>    
                <div class="form-group">
                    <div class="col-xs-8"> 
                        <textarea name="choices[<%= i %>]" class="form-control" rows="1" disabled></textarea>
                    </div>
                </div>
            <% } %>
        <% } else { %>
            <div class="col-sm-10 short-answer">
            <% _.each(question.choices, function (choice, i) { %>    
                <div class="form-group">
                    <div class="col-xs-8"> 
                        <textarea name="choices[<%= i %>]" class="form-control" rows="1"><%= choice %></textarea>
                    </div>
                </div>
            <% }) %> 
        <% } %>
                <div class="form-group">
                    <div class="col-sm-10">
                        <button type="button" class="btn btn-default btn-sm btn-add-choice">
                            <span class="glyphicon glyphicon-plus"></span> Add another correct answer
                        </button>
                    </div>
                </div>
            </div>
    </div>

    <!-- options -->

    <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
            <a href="#options" data-toggle="collapse" data-target="#options">Show/hide additional options</a>
        </div>
    </div>

    <div id="options" class="collapse">

        <div class="form-group">
            <label for="question" class="col-sm-2 control-label">Shuffle choices?</label>
            <div class="col-sm-6">
                <input type="checkbox" name="shuffleChoices" value="1" class="bootstrap-switch"<%= 
                    _.defaultTo(question.shuffleChoices, quiz.shuffleChoices) == 1 ? ' checked' : '' %> >
            </div>
        </div>

        <div class="form-group">
            <label for="question" class="col-sm-2 control-label">Shuffle choices?</label>
            <div class="col-sm-6">
                <input type="checkbox" name="shuffleChoices" value="1" class="bootstrap-switch"<%= 
                    _.defaultTo(question.shuffleChoices, quiz.shuffleChoices) == 1 ? ' checked' : '' %> >
            </div>
        </div>

        <div class="form-group">
            <label for="question" class="col-sm-2 control-label">Format using LaTeX?</label>
            <div class="col-sm-6">
                <input type="checkbox" name="useLaTeX" value="1"  class="bootstrap-switch"<%= 
                    _.defaultTo(question.useLaTeX, quiz.useLaTeX) == 1 ? ' checked' : '' %>>
            </div>
        </div>

        <div class="form-group">
            <label for="question" class="col-sm-2 control-label">Points possible</label>
            <div class="col-sm-6">
                <input type="number" name="points" value="<%= 
                    _.defaultTo(question.points, quiz.points) %>" min="0" max="7" class="form-control">
            </div>
        </div>

        <div class="form-group">
            <label for="question" class="col-sm-2 control-label">First-try bonus</label>
            <div class="col-sm-6">
                <input type="number" name="firstTryBonus" value="<%= 
                    _.defaultTo(question.firstTryBonus, quiz.firstTryBonus) %>" min="0" max="7" class="form-control">
            </div>
        </div>

        <div class="form-group">
            <label for="question" class="col-sm-2 control-label">Penalty per attempt</label>
            <div class="col-sm-6">
                <input type="number" name="penalty" value="<%= 
                    _.defaultTo(question.penalty, quiz.penalty) %>" min="0" max="7" class="form-control">
            </div>
        </div>

    </div>

    <div class="form-group" style="margin-top: 30px;">
        <div class="col-sm-offset-2 col-sm-10">
            <a href="/admin/courses/<%= course.id %>/quizzes/<%= quiz.id %>/questions" class="btn btn-default btn-sm">Cancel</a>
            <button type="submit" class="btn btn-primary btn-sm">Save</button>
        </div>
    </div>
</form>

<!-- templates -->

<script type="text/template" id="multiple-choice-template">
    <div class="form-group">
        <div class="col-xs-8"> 
            <textarea name="choices[${ id }]" class="form-control" rows="1"></textarea>
        </div>
        <div class="col-xs-4 radio">
            <label><input type="radio" name="answer[multiple-choice]" value="${ id }"></label>
        </div>
    </div>
</script>

<script type="text/template" id="multiple-select-template">
    <div class="form-group">
        <div class="col-xs-8"> 
            <textarea name="choices[${ id }]" class="form-control" rows="1"></textarea>
        </div>
        <div class="col-xs-4 checkbox">
            <label><input type="checkbox" name="answers[multiple-select][]" value="${ id }"></label>
        </div>
    </div>
</script>

<script type="text/template" id="short-answer-template">
    <div class="form-group">
        <div class="col-xs-8"> 
            <textarea name="choices[${ id }]" class="form-control" rows="1"></textarea>
        </div>
    </div>
</script>

<%- include ./footer -%>